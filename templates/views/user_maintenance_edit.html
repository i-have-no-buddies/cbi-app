<!-- layout -->
{{extend './layout.html'}} 
<!-- content -->
{{block 'content'}}
<div class="card">
  <form action="/user-maintenance/update/{{user._id.toString()}}" method="post" id="formUserUpdate">
    <div class="card-body">
      <div class="form-group">
        <label>First Name</label>
        <input 
          type="text" 
          class="form-control" 
          name="first_name" 
          value="{{if user}}{{user.first_name}}{{/if}}" 
        />
        <small class="form-text text-danger" id="first_name_error"></small>
      </div>
      <div class="form-group">
        <label>Last Name</label>
        <input 
          type="text" 
          class="form-control" 
          name="last_name" 
          value="{{if user}}{{user.last_name}}{{/if}}" 
        />
        <small class="form-text text-danger" id="last_name_error"></small>
      </div>
      <div class="form-group">
        <label>Phone Number</label>
        <input 
          type="text" 
          class="form-control" 
          name="phone_number" 
          value="{{if user}}{{user.phone_number}}{{/if}}" 
        />
      </div>
      <div class="form-group">
        <label>Email</label>
        <input 
          type="email" 
          class="form-control" 
          name="email" 
          value="{{if user}}{{user.email}}{{/if}}" 
        />
        <small class="form-text text-danger" id="email_error"></small>
      </div>
      <div class="form-group">
        <label>Password</label>
        <input 
          type="password" 
          class="form-control" 
          name="password" 
          value="{{if user}}{{user.password}}{{/if}}"
        />
        <small class="form-text text-danger" id="password_error"></small>
      </div>
      <div class="form-group">
        <label>User Type</label>
        <select class="form-control" name="type">
          {{each USER_TYPE}}
          <option 
            value="{{$value}}"
            {{if user}}{{if user.type == $value}}selected{{/if}}{{/if}}
          >{{$value}}</option>
          {{/each}}
        </select>
        <small class="form-text text-danger" id="type_error"></small>
      </div>
      <div class="form-group">
        <label>User Status</label>
        <select class="form-control" name="status">
          {{each USER_STATUS}}
          <option 
            value="{{$value}}"
            {{if user}}{{if user.status == $value}}selected{{/if}}{{/if}}
          >{{$value}}</option>
          {{/each}}
        </select>
        <small class="form-text text-danger" id="status_error"></small>
      </div>
    </div>
    <div class="card-footer">
      <div class="form-group">
        <button 
          type="button" 
          class="btn bg-teal btn-block font-weight-bold"
          id="btnUserUpdate"
        ><i class="fas fa-save"></i> Update User</button>
      </div>
    </div>
  </form>
</div>
{{/block}}
<!-- javascript -->
{{block 'javascript'}}
<script>
  function handleError(key, value) {
    $(`[name="${key}"]`).addClass('is-invalid');
    $(`#${key}_error`).html(value);
  }

  $(document).ready(function() {
    $('#btnUserUpdate').on('click', function() {
      Swal.fire({
        icon: 'question',
        title: 'Do you really want to update the user?',
        showCancelButton: true,
        confirmButtonText: '<i class="fas fa-save"></i> Update',
        confirmButtonColor: '#20c997',
        cancelButtonText: '<i class="fas fa-times"></i> Cancel',
        cancelButtonColor: '#d81b60',
      }).then((result) => {
        if (result.isConfirmed) {
          $('#formUserUpdate').submit();
        }
      });
    });
  });

  {{each errors}}
    handleError(`{{$index}}`,`{{$value}}`)
  {{/each}}
</script>
{{/block}}