{{extend './layout.html'}} {{block 'content'}}
<div class="row">
  <div class="col-md-3">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title font-weight-bold">
          <i class="fas fa-search"></i> Search
        </h3>
      </div>
      <div class="card-body">
        <div class="form-group">
          <label>Search</label>
          <input
            type="search"
            class="form-control"
            id="name"
            placeholder="Name"
            onsearch="search(1);"
          />
        </div>
        <div class="form-group">
          <select
            class="form-control select2bs4"
            id="ifa"
            onchange="search(1)"
            style="width: 100%"
          >
            <option value="">Select IFA</option>
            {{each IFA}}
            <option value="{{$value.first_name}} {{$value.last_name}}">
              {{$value.first_name}} {{$value.last_name}}
            </option>
            {{/each}}
          </select>
        </div>
        <div class="form-group">
          <select
            class="form-control select2bs4"
            id="bdm"
            onchange="search(1)"
            style="width: 100%"
          >
            <option value="">Select BDM</option>
            {{each BDM}}
            <option value="{{$value.first_name}} {{$value.last_name}}">
              {{$value.first_name}} {{$value.last_name}}
            </option>
            {{/each}}
          </select>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <h3 class="card-title font-weight-bold">
          <i class="fas fa-cog"></i> Option
        </h3>
      </div>
      <div class="card-body">
        <div class="form-group">
          <a href="/bdm-settings/add" class="btn bg-teal btn-block">
            <i class="fas fa-plus"></i>
            Add Settings
          </a>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-9">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title font-weight-bold">
          <i class="fas fa-table"></i> Table
        </h3>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Name</th>
                <th>IFA</th>
                <th>BDM</th>
                <th>Status</th>
                <th>Option</th>
              </tr>
            </thead>
            <tbody>
              {{each settings.docs}}
              <tr>
                <td>{{$value.name}}</td>
                <td>{{$value.ifa_name | titleCase}}</td>
                <td>{{$value.bdm_name| titleCase}}</td>
                <td>{{$value.status | titleCase}}</td>
                <td>
                  <form
                    action="/bdm-settings/delete/{{$value._id.toString()}}"
                    method="post"
                    id="formBdmSettingsDelete{{$index}}"
                  >
                    <a
                      href="/bdm-settings/edit/{{$value._id.toString()}}"
                      class="btn bg-teal btn-sm"
                    >
                      <i class="fas fa-edit"></i> Edit</a
                    >
                    <button
                      type="button"
                      class="btn bg-maroon btn-sm"
                      onclick="deleteBdmSettings('#formBdmSettingsDelete{{$index}}');"
                    >
                      <i class="fas fa-times"></i> Delete
                    </button>
                  </form>
                </td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer">
        <nav aria-label="Contacts Page Navigation">
          <ul
            class="pagination justify-content-center m-0"
            id="pagination"
          ></ul>
        </nav>
      </div>
    </div>
  </div>
</div>
{{/block}} {{block 'javascript'}}
<script src="/app/global.js"></script>
<script>
  const page = parseInt('{{settings.page}}');
  const totalPages = parseInt('{{settings.totalPages}}');
  const totalDocs = parseInt('{{settings.totalDocs}}');
  document.getElementById('name').value = decodeHTML(
    '{{search.name | escapeBackslash}}'
  );
  document.getElementById('ifa').value = decodeHTML(
    '{{search.ifa | escapeBackslash}}'
  );
  document.getElementById('bdm').value = decodeHTML(
    '{{search.bdm | escapeBackslash}}'
  );

  function search(page) {
    let url = window.location.href.split('?')[0];
    let name = $('#name').val();
    let ifa = $('#ifa').val();
    let bdm = $('#bdm').val();
    url += `?page=${page}`;
    if (name) url += `&name=${name}`;
    if (ifa) url += `&ifa=${ifa}`;
    if (bdm) url += `&bdm=${bdm}`;
    window.location.href = url;
  }

  function deleteBdmSettings(form) {
    Swal.fire({
      icon: 'question',
      title: 'Do you really want to delete the BDM Settings?',
      showCancelButton: true,
      confirmButtonText: '<i class="fas fa-save"></i> Delete',
      confirmButtonColor: '#20c997',
      cancelButtonText: '<i class="fas fa-times"></i> Cancel',
      cancelButtonColor: '#d81b60',
    }).then((result) => {
      if (result.isConfirmed) {
        $(form).submit();
      }
    });
  }

  $(document).ready(function () {
    $('.select2bs4').select2({
      theme: 'bootstrap4',
    });
    $('#pagination').html(pagination(page, totalPages, totalDocs, 'search'));
  });
</script>
{{/block}}
